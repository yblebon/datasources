<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mom Joke Image Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        button {
            padding: 15px 30px;
            font-size: 1.2em;
            background-color: #ff6f61;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #e55a50;
        }
        #joke-canvas {
            margin-top: 20px;
            display: none;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #error-message {
            margin-top: 20px;
            color: red;
            font-size: 1.2em;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Mom Joke Image Generator</h1>
    <button onclick="showJoke()">Get a Mom Joke!</button>
    <canvas id="joke-canvas" width="400" height="200"></canvas>
    <div id="error-message"></div>

    <script>
        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            const lines = [];

            for (let i = 0; i < words.length; i++) {
                const testLine = line + words[i] + ' ';
                const metrics = context.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && i > 0) {
                    lines.push(line);
                    line = words[i] + ' ';
                } else {
                    line = testLine;
                }
            }
            lines.push(line);

            for (let i = 0; i < lines.length; i++) {
                context.fillText(lines[i], x, y + i * lineHeight);
            }
        }

        function convertToMomJoke(dadJoke) {
            // Combine setup and punchline
            let joke = dadJoke.setup + ' ' + dadJoke.punchline;

            // Simple transformations to make it a mom joke
            joke = joke
                .replace(/\bdad\b/gi, 'mom') // Replace "dad" with "mom" (case-insensitive)
                .replace(/\bfather\b/gi, 'mother')
                .replace(/\bhe\b/gi, 'she')
                .replace(/\bhim\b/gi, 'her')
                .replace(/\bhis\b/gi, 'her');

            // Additional transformations for context
            const momThemes = [
                { pattern: /\bgrill\b/gi, replacement: 'kitchen' },
                { pattern: /\btools\b/gi, replacement: 'recipes' },
                { pattern: /\bcar\b/gi, replacement: 'minivan' },
                { pattern: /\bfishing\b/gi, replacement: 'baking' },
                { pattern: /\bjoke\b/gi, replacement: 'hug' }
            ];

            momThemes.forEach(theme => {
                joke = joke.replace(theme.pattern, theme.replacement);
            });

            // Ensure the joke ends with proper punctuation
            if (!joke.endsWith('!') && !joke.endsWith('?')) {
                joke += '!';
            }

            return joke;
        }

        async function showJoke() {
            const canvas = document.getElementById('joke-canvas');
            const ctx = canvas.getContext('2d');
            const errorMessage = document.getElementById('error-message');

            // Clear previous content
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            canvas.style.display = 'none';
            errorMessage.style.display = 'none';

            try {
                // Fetch a random dad joke from the API
                const response = await fetch('https://official-joke-api.appspot.com/jokes/random');
                if (!response.ok) {
                    throw new Error('Failed to fetch joke');
                }
                const dadJoke = await response.json();
                const momJoke = convertToMomJoke(dadJoke); // Convert to mom joke

                // Draw on canvas
                ctx.fillStyle = '#ff6f61'; // Coral background for mom theme
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'white';
                ctx.font = '20px Arial';
                ctx.textAlign = 'center';
                wrapText(ctx, momJoke, canvas.width / 2, 60, canvas.width - 40, 30);
                canvas.style.display = 'block';
            } catch (error) {
                errorMessage.textContent = 'Oops! Couldnâ€™t fetch a joke. Try again!';
                errorMessage.style.display = 'block';
            }
        }
    </script>
</body>
</html>
